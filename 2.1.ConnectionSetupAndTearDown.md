# Connection Setup and Teardown

## Connection Setup
In the connection setup phase, the initiator (an end node quantum computer that sends starts a process) sends a request to a responder (an end node quantum computer that provides a quantum application service) and that responder creates a set of RuleSet and distributes them to the intermediate quantum repeaters and routers.

## Protocol Sequence

```mermaid
sequenceDiagram
    autonumber
    participant Initiator
    participant Repeater 0
    participant ...
    Participant Repeater N
    participant Responder

    Note over Initiator: Form a request to a Responder
    Initiator ->> Repeater 0: Connection Setup Request (CSR)
    Repeater 0 ->> Repeater 0: Stack local information
    Repeater 0 ->> ... : CSR
    ... ->> ...: Stack local information
    ... ->> Repeater N: CSR
    Repeater N ->> Repeater N: Stack local information
    Repeater N ->> Responder: CSR
    Note over Responder: Create RuleSets

    Responder ->> Responder: RuleSet
    Responder ->> Repeater N: RuleSet
    Responder ->> ...: RuleSet
    Responder ->> Repeater 0: RuleSet
    Responder ->> Initiator: RuleSet
```

### Contents of Connection Setup Request
:warning: (Under construction)
- Bell pair per sec?
- Fidelity of Bell pairs?
- Link cost requirements?

## Connection Teardown

## Protocol Sequence
An example sequence of the entire protocol
```mermaid
sequenceDiagram
    autonumber
    participant i1 as Initiator 1
    participant i2 as Initiator 2 
    box Purple MIM Link
    participant ra as Repeater A
    participant bsa as BSA
    participant rb as Repeater B
    end 
    participant r2 as Responder 2
    participant r1 as Responder 1

    i1 --> r1: Connection 1 (cid = 1)
    i2 --> r2: Connection 2 (cid = 2)
    r1 ->> rb: Terminate Connection 1
    bsa -->> ra: Photon ID (237)
    bsa -->> rb: Photon ID (237)
    Note over ra: Assign 237 to Connection 1
    Note over rb: Hold 237
    
    r1 ->> ra: Terminate Connection 1
    rb ->> ra: Switch to Sync Mode
    ra ->> rb: Sync Ack (I assigned 237 to cid=1)
    Note over rb: Assign 237 to Connection 1
    rb ->> ra: Ack
```
:warning: (Under construction)
- How and when do we notify it to the application?
- What information to be attached?
